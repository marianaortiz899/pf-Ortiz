import{a as Wt}from"./chunk-GIPJPKZG.js";import{a as nt}from"./chunk-5DVIUDZZ.js";import{c as Gt}from"./chunk-MGAOFYJB.js";import{b as Nt,c as h,d as Lt,e as et,l as kt,n as D,o as G,p as Bt,q as Ut,r as ft,s as ut,t as Vt,u as R,v as Ht}from"./chunk-RJSKI22Y.js";import{a as Ye,b as $}from"./chunk-OW7T7RJ3.js";import{$ as re,Ca as Se,G as it,H as zt,J as Kt,M as dt,N as qt,O as Yt,Q as Jt,R as Xt,S as Zt,T as Qt,W as te,X as ee,Y as ie,Z as ne,_ as oe,aa as se,ba as ce,ca as ae,da as pe,fa as le,ia as fe,ma as ue,ta as de,u as Pt,ua as me,va as he,wa as Ie,xa as ge,ya as Ee,za as _e}from"./chunk-JAVY5PA6.js";import{B as at,Bb as Dt,C as K,Cb as u,Db as Rt,E as _,Eb as U,F,Fb as W,H as xt,I as Ft,Ib as V,Jb as H,L as yt,Lb as jt,Ma as Mt,N as bt,Na as d,Oa as v,P as pt,Q as Tt,Ub as wt,Vb as $t,Xa as E,Xb as tt,Za as m,_b as Ot,a as I,ac as At,b as S,ca as y,da as b,e as qe,ea as C,fa as l,ga as q,gb as p,h as St,hb as f,ia as Y,ib as Z,j as Ct,ja as T,jb as k,kb as B,lc as lt,mb as Q,na as J,oa as X,q as L,qb as A,r as vt,sb as M,u as g,w as O}from"./chunk-KXB77ZPS.js";var r=Lt({source:"Inscriptions",events:{"Load Inscriptions":et(),"Load Inscriptions Success":h(),"Load Inscriptions Failure":h(),"Load Students":et(),"Load Students Success":h(),"Load Students Failure":h(),"Load Courses":et(),"Load Courses Success":h(),"Load Courses Failure":h(),"Create Inscription":h(),"Create Inscription Success":h(),"Create Inscription Failure":h(),"Edit Inscription":h(),"Edit Inscription Success":h(),"Edit Inscription Failure":h(),"Delete Inscription":h()}});var mt="inscriptions",Je={students:[],inscriptions:[],courses:[],loading:!1,loadingStudent:!1,error:null},Xe=Ht(Je,R(r.loadInscriptions,t=>S(I({},t),{loading:!0})),R(r.loadInscriptionsSuccess,(t,e)=>S(I({},t),{loading:!1,inscriptions:e.data})),R(r.loadInscriptionsFailure,(t,e)=>S(I({},t),{loading:!1,error:e.error})),R(r.loadStudents,t=>S(I({},t),{loadingStudent:!0})),R(r.loadStudentsSuccess,(t,e)=>S(I({},t),{loadingStudent:!1,students:e.data})),R(r.loadStudentsFailure,(t,e)=>S(I({},t),{loading:!1,error:e.error})),R(r.loadCoursesSuccess,(t,e)=>S(I({},t),{courses:e.data}))),Ce=Ut({name:mt,reducer:Xe});var ot=Bt(mt),ve=G(ot,t=>t.inscriptions),xe=G(ot,t=>t.loading),Fe=G(ot,t=>t.students),ye=G(ot,t=>t.courses);function ei(t,e){if(t&1&&(p(0,"mat-option",9),u(1),f()),t&2){let o=e.$implicit;m("value",o.id),d(),W(" ",o.firstName," ",o.lastName," ")}}function ii(t,e){if(t&1&&(p(0,"mat-option",9),u(1),f()),t&2){let o=e.$implicit;m("value",o.id),d(),U(" ",o.name," ")}}var ht=(()=>{let e=class e{constructor(i,n,s,c){this.store=i,this.data=n,this.formBuilder=s,this.matDialogRef=c,this.inscription={id:0,userId:null,courseId:null},this.edit=!1,this.inscriptionForm=this.formBuilder.group({courseId:this.formBuilder.control("",[dt.required]),userId:this.formBuilder.control("",[dt.required])}),this.edit=n.edit,this.edit&&(this.inscription=n.inscription,this.inscriptionForm.get("userId")?.disable(),this.inscriptionForm.get("userId")?.setValue(n.inscription.userId),this.inscriptionForm.get("courseId")?.setValue(n.inscription.courseId)),this.store.dispatch(r.loadStudents()),this.courses$=this.store.select(ye),this.store.dispatch(r.loadCourses()),this.students$=this.store.select(Fe)}onSubmit(){this.inscriptionForm.invalid?this.inscriptionForm.markAllAsTouched():this.edit?(this.store.dispatch(r.editInscription({data:{id:this.inscription.id,courseId:this.inscriptionForm.controls.courseId.value,userId:this.inscription.userId}})),this.matDialogRef.close(!0)):(this.store.dispatch(r.createInscription({data:this.inscriptionForm.value})),this.matDialogRef.close(!0))}};e.\u0275fac=function(n){return new(n||e)(v(D),v(me),v(Qt),v(de))},e.\u0275cmp=Y({type:e,selectors:[["app-inscription-dialog"]],decls:21,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],["formControlName","userId"],[3,"value",4,"ngFor","ngForOf"],["formControlName","courseId"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close",""],["mat-button","",3,"click"],[3,"value"]],template:function(n,s){n&1&&(p(0,"h1",0),u(1),f(),p(2,"div",1)(3,"form",2)(4,"mat-form-field")(5,"mat-label"),u(6,"Estudiante"),f(),p(7,"mat-select",3),E(8,ei,2,3,"mat-option",4),V(9,"async"),f()(),p(10,"mat-form-field")(11,"mat-label"),u(12,"Curso"),f(),p(13,"mat-select",5),E(14,ii,2,2,"mat-option",4),V(15,"async"),f()()()(),p(16,"div",6)(17,"button",7),u(18,"Cancelar"),f(),p(19,"button",8),A("click",function(){return s.onSubmit()}),u(20,"Guardar"),f()()),n&2&&(d(),Rt(s.edit?"Editar venta":"Crear venta"),d(2),m("formGroup",s.inscriptionForm),d(5),m("ngForOf",H(9,4,s.students$)),d(6),m("ngForOf",H(15,6,s.courses$)))},dependencies:[wt,it,Ie,ge,_e,Ee,fe,le,Jt,qt,Yt,Xt,Zt,ue,Pt,tt]});let t=e;return t})();var P=qe(Ye());var rt=(()=>{let e=class e{constructor(i){this.http=i}getInscriptions(){return this.http.get(`${$.apiURL}/inscriptions?_embed=user&_embed=course`)}getInscriptionsById(i){return this.http.get(`${$.apiURL}/users/${i}`).pipe(F(n=>this.http.get(`${$.apiURL}/inscriptions?userId=${n.id}`)),_(n=>vt(()=>n)))}createInscriptions(i){return this.http.post(`${$.apiURL}/inscriptions`,i)}deleteInscription(i){let n=`${$.apiURL}/inscriptions/${i}`;return this.http.delete(n)}updateInscriptionById(i,n){let s=`${$.apiURL}/inscriptions/${i}`;return this.http.put(s,n).pipe(_(c=>{throw console.error("Error en la solicitud PUT:",c),c}))}};e.\u0275fac=function(n){return new(n||e)(l(At))},e.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function ni(t,e){if(t&1){let o=Q();p(0,"button",3),A("click",function(){J(o);let n=M();return X(n.createInscription())}),u(1,` Crear inscripci\xF3n
`),f()}}function oi(t,e){t&1&&(p(0,"div"),u(1,` Cargando...
`),f())}function ri(t,e){t&1&&(p(0,"th",13),u(1," No. "),f())}function si(t,e){if(t&1&&(p(0,"td",14),u(1),f()),t&2){let o=e.$implicit;d(),U(" ",o.id," ")}}function ci(t,e){t&1&&(p(0,"th",13),u(1," Nombre del estudiante "),f())}function ai(t,e){if(t&1&&(p(0,"td",14),u(1),f()),t&2){let o=e.$implicit;d(),W(" ",o.user.firstName," ",o.user.lastName," ")}}function pi(t,e){t&1&&(p(0,"th",13),u(1,"curso "),f())}function li(t,e){if(t&1&&(p(0,"td",14),u(1),f()),t&2){let o=e.$implicit;d(),U(" ",o.course.name," ")}}function fi(t,e){t&1&&Z(0,"th",13)}function ui(t,e){if(t&1){let o=Q();p(0,"button",16),A("click",function(){J(o);let n=M().$implicit,s=M(2);return X(s.deleteInscription(n.id))}),p(1,"mat-icon"),u(2,"delete"),f()()}}function di(t,e){if(t&1){let o=Q();p(0,"button",16),A("click",function(){J(o);let n=M().$implicit,s=M(2);return X(s.editInscription(n))}),p(1,"mat-icon"),u(2,"edit"),f()()}}function mi(t,e){if(t&1&&(p(0,"td",14),E(1,ui,3,0,"button",15)(2,di,3,0,"button",15),f()),t&2){let o=M(2);d(),m("ngIf",o.role!=="STUDENT"),d(),m("ngIf",o.role!=="STUDENT")}}function hi(t,e){t&1&&Z(0,"tr",17)}function Ii(t,e){t&1&&Z(0,"tr",18)}function gi(t,e){if(t&1&&(p(0,"table",4),k(1,5),E(2,ri,2,0,"th",6)(3,si,2,1,"td",7),B(),k(4,8),E(5,ci,2,0,"th",6)(6,ai,2,2,"td",7),B(),k(7,9),E(8,pi,2,0,"th",6)(9,li,2,1,"td",7),B(),k(10,10),E(11,fi,1,0,"th",6)(12,mi,3,2,"td",7),B(),E(13,hi,1,0,"tr",11)(14,Ii,1,0,"tr",12),f()),t&2){let o=M();m("dataSource",o.inscriptions),d(13),m("matHeaderRowDef",o.displayedColumns),d(),m("matRowDefColumns",o.displayedColumns)}}var Me=(()=>{let e=class e{constructor(i,n,s){this.inscriptionsService=i,this.store=n,this.matDialog=s,this.inscriptions=[],this.displayedColumns=["id","student","course","action"],this.role="",this.inscriptionsSubscription=this.store.select(ve).subscribe({next:c=>{this.inscriptions=c}}),this.isLoading$=this.store.select(xe),this.store.dispatch(r.loadInscriptions()),this.authUser$=this.store.select(Gt),this.authUser$.subscribe(c=>{this.role=c?.role})}createInscription(){this.matDialog.open(ht,{data:{edit:!1}}).afterClosed().subscribe(n=>{n&&P.default.fire("\xC9xito","La clase se cre\xF3 correctamente","success")})}ngOnDestroy(){this.inscriptionsSubscription?.unsubscribe()}editInscription(i){this.matDialog.open(ht,{data:{inscription:i,edit:!0}}).afterClosed().subscribe(s=>{s&&P.default.fire("\xC9xito","La clase se edit\xF3 correctamente","success")})}deleteInscription(i){P.default.fire({title:"\xBFEst\xE1s seguro de eliminar?",text:"Esta acci\xF3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&(this.store.dispatch(r.deleteInscription({id:i})),P.default.fire("Eliminado","La inscripci\xF3n ha sido eliminada","success"))})}};e.\u0275fac=function(n){return new(n||e)(v(rt),v(D),v(he))},e.\u0275cmp=Y({type:e,selectors:[["app-inscriptions"]],decls:5,vars:5,consts:[["mat-flat-button","","type","button","color","accent",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notLoading",""],["mat-flat-button","","type","button","color","accent",3,"click"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","student"],["matColumnDef","course"],["matColumnDef","action",1,"col-6"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","class","col-offset-6",3,"click",4,"ngIf"],["mat-icon-button","",1,"col-offset-6",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,s){if(n&1&&(E(0,ni,2,0,"button",0)(1,oi,2,0,"div",1),V(2,"async"),E(3,gi,15,3,"ng-template",null,2,jt)),n&2){let c=Dt(4);m("ngIf",s.role!=="STUDENT"),d(),m("ngIf",H(2,3,s.isLoading$))("ngIfElse",c)}},dependencies:[$t,te,ie,se,ne,ee,ce,oe,re,ae,pe,it,zt,Kt,tt]});let t=e;return t})();var Ei=[{path:"inscriptions",component:Me}],De=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=T({type:e}),e.\u0275inj=b({imports:[lt.forChild(Ei),lt]});let t=e;return t})();var _i={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},ct="__@ngrx/effects_create__";function j(t,e={}){let o=e.functional?t:t(),i=I(I({},_i),e);return Object.defineProperty(o,ct,{value:i}),o}function Si(t){return Object.getOwnPropertyNames(t).filter(i=>t[i]&&t[i].hasOwnProperty(ct)?t[i][ct].hasOwnProperty("dispatch"):!1).map(i=>{let n=t[i][ct];return I({propertyName:i},n)})}function Ci(t){return Si(t)}function $e(t){return Object.getPrototypeOf(t)}function vi(t){return!!t.constructor&&t.constructor.name!=="Object"&&t.constructor.name!=="Function"}function Oe(t){return typeof t=="function"}function Re(t){return t.filter(Oe)}function xi(t){return t instanceof C||Oe(t)}function Fi(t,e,o){let i=$e(t),s=!!i&&i.constructor.name!=="Object"?i.constructor.name:null,c=Ci(t).map(({propertyName:a,dispatch:x,useEffectsErrorHandler:Et})=>{let z=typeof t[a]=="function"?t[a]():t[a],_t=Et?o(z,e):z;return x===!1?_t.pipe(Ft()):_t.pipe(Tt()).pipe(g(Ke=>({effect:t[a],notification:Ke,propertyName:a,sourceName:s,sourceInstance:t})))});return at(...c)}var yi=10;function Ae(t,e,o=yi){return t.pipe(_(i=>(e&&e.handleError(i),o<=1?t:Ae(t,e,o-1))))}var Ne=(()=>{let e=class e extends St{constructor(i){super(),i&&(this.source=i)}lift(i){let n=new e;return n.source=this,n.operator=i,n}};e.\u0275fac=function(n){return new(n||e)(l(kt))},e.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function w(...t){return K(e=>t.some(o=>typeof o=="string"?o===e.type:o.type===e.type))}var Le=new C("@ngrx/effects Internal Root Guard"),st=new C("@ngrx/effects User Provided Effects"),It=new C("@ngrx/effects Internal Root Effects"),ke=new C("@ngrx/effects Internal Root Effects Instances"),je=new C("@ngrx/effects Internal Feature Effects"),Be=new C("@ngrx/effects Internal Feature Effects Instance Groups"),bi=new C("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>Ae}),Ue="@ngrx/effects/init",$n=Nt(Ue);function Ti(t,e){if(t.notification.kind==="N"){let o=t.notification.value;!Mi(o)&&e.handleError(new Error(`Effect ${Di(t)} dispatched an invalid action: ${Ri(o)}`))}}function Mi(t){return typeof t!="function"&&t&&t.type&&typeof t.type=="string"}function Di({propertyName:t,sourceInstance:e,sourceName:o}){let i=typeof e[t]=="function";return!!o?`"${o}.${String(t)}${i?"()":""}"`:`"${String(t)}()"`}function Ri(t){try{return JSON.stringify(t)}catch{return t}}var ji="ngrxOnIdentifyEffects";function wi(t){return gt(t,ji)}var $i="ngrxOnRunEffects";function Oi(t){return gt(t,$i)}var Ai="ngrxOnInitEffects";function Ni(t){return gt(t,Ai)}function gt(t,e){return t&&e in t&&typeof t[e]=="function"}var Ve=(()=>{let e=class e extends Ct{constructor(i,n){super(),this.errorHandler=i,this.effectsErrorHandler=n}addEffects(i){this.next(i)}toActions(){return this.pipe(pt(i=>vi(i)?$e(i):i),O(i=>i.pipe(pt(Li))),O(i=>{let n=i.pipe(bt(c=>ki(this.errorHandler,this.effectsErrorHandler)(c)),g(c=>(Ti(c,this.errorHandler),c.notification)),K(c=>c.kind==="N"&&c.value!=null),yt()),s=i.pipe(xt(1),K(Ni),g(c=>c.ngrxOnInitEffects()));return at(n,s)}))}};e.\u0275fac=function(n){return new(n||e)(l(Mt),l(bi))},e.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Li(t){return wi(t)?t.ngrxOnIdentifyEffects():""}function ki(t,e){return o=>{let i=Fi(o,t,e);return Oi(o)?o.ngrxOnRunEffects(i):i}}var He=(()=>{let e=class e{get isStarted(){return!!this.effectsSubscription}constructor(i,n){this.effectSources=i,this.store=n,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}};e.\u0275fac=function(n){return new(n||e)(l(Ve),l(D))},e.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),Ge=(()=>{let e=class e{constructor(i,n,s,c,a,x,Et){this.sources=i,n.start();for(let z of c)i.addEffects(z);s.dispatch({type:Ue})}addEffects(i){this.sources.addEffects(i)}};e.\u0275fac=function(n){return new(n||e)(l(Ve),l(He),l(D),l(ke),l(ft,8),l(ut,8),l(Le,8))},e.\u0275mod=T({type:e}),e.\u0275inj=b({});let t=e;return t})(),Bi=(()=>{let e=class e{constructor(i,n,s,c){let a=n.flat();for(let x of a)i.addEffects(x)}};e.\u0275fac=function(n){return new(n||e)(l(Ge),l(Be),l(ft,8),l(ut,8))},e.\u0275mod=T({type:e}),e.\u0275inj=b({});let t=e;return t})(),Pe=(()=>{let e=class e{static forFeature(...i){let n=i.flat(),s=Re(n);return{ngModule:Bi,providers:[s,{provide:je,multi:!0,useValue:n},{provide:st,multi:!0,useValue:[]},{provide:Be,multi:!0,useFactory:we,deps:[je,st]}]}}static forRoot(...i){let n=i.flat(),s=Re(n);return{ngModule:Ge,providers:[s,{provide:It,useValue:[n]},{provide:Le,useFactory:Ui},{provide:st,multi:!0,useValue:[]},{provide:ke,useFactory:we,deps:[It,st]}]}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=T({type:e}),e.\u0275inj=b({});let t=e;return t})();function we(t,e){let o=[];for(let i of t)o.push(...i);for(let i of e)o.push(...i);return o.map(i=>xi(i)?q(i):i)}function Ui(){let t=q(He,{optional:!0,skipSelf:!0}),e=q(It,{self:!0});if(!(e.length===1&&e[0].length===0)&&t)throw new TypeError("EffectsModule.forRoot() called twice. Feature modules should use EffectsModule.forFeature() instead.");return"guarded"}var ze=(()=>{let e=class e{constructor(i,n,s,c){this.actions$=i,this.inscriptionsService=n,this.usersService=s,this.coursesService=c,this.loadInscriptions$=j(()=>this.actions$.pipe(w(r.loadInscriptions),F(()=>this.inscriptionsService.getInscriptions().pipe(g(a=>r.loadInscriptionsSuccess({data:a})),_(a=>L(r.loadInscriptionsFailure({error:a}))))))),this.loadStudents$=j(()=>this.actions$.pipe(w(r.loadStudents),F(()=>this.usersService.getAllStudents().pipe(g(a=>r.loadStudentsSuccess({data:a})),_(a=>L(r.loadStudentsFailure({error:a}))))))),this.loadCourses$=j(()=>this.actions$.pipe(w(r.loadCourses),F(()=>this.coursesService.getCourses().pipe(g(a=>r.loadCoursesSuccess({data:a})),_(a=>L(r.loadCoursesFailure({error:a}))))))),this.createInscription$=j(()=>this.actions$.pipe(w(r.createInscription),F(a=>this.inscriptionsService.createInscriptions(a.data).pipe(g(x=>r.createInscriptionSuccess({data:x})),_(x=>L(r.createInscriptionFailure({error:x}))))))),this.createInscriptionSuccess$=j(()=>this.actions$.pipe(w(r.createInscriptionSuccess),g(()=>r.loadInscriptions()))),this.deleteInscription$=j(()=>this.actions$.pipe(w(r.deleteInscription),O(a=>this.inscriptionsService.deleteInscription(a.id).pipe(g(()=>r.loadInscriptions()))))),this.editInscription$=j(()=>this.actions$.pipe(w(r.editInscription),O(a=>this.inscriptionsService.updateInscriptionById(a.data.id,a.data).pipe(g(()=>r.loadInscriptions())))))}};e.\u0275fac=function(n){return new(n||e)(l(Ne),l(rt),l(Wt),l(nt))},e.\u0275prov=y({token:e,factory:e.\u0275fac});let t=e;return t})();var to=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=T({type:e}),e.\u0275inj=b({providers:[nt],imports:[Ot,De,Se,Vt.forFeature(Ce),Pe.forFeature([ze])]});let t=e;return t})();export{Pe as a,to as b};
